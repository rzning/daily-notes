# MQTT 中文站教程

## MQTT 协议初学者指南

> [MQTT 协议初学者指南 - MQTT 中文站](https://www.mqtt.cn/1172.html)

MQTT（消息队列遥测传输）是一种轻量级的发布/订阅消息传输协议，专为 M2M（机器对机器）遥测在低带宽环境中设计。

- MQTT 版本
  - MQTT v3.1.0
  - MQTT v3.1.1 - 目前使用最广泛版本
  - MQTT v5.0
  - MQTT-SN - 约在 2013 年制定，用于 UDP 、 ZigBee 等传输方式。
- MQTT 客户端
  - 不需要为客户端分配地址。
  - Eclipse Paho 是一款比较常用的客户端软件。
- MQTT 代理或服务器
  - 最初的术语是代理，但现在已标准化为服务器。
  - 最受欢迎的自托管代理之一是免费开源的 Mosquitto
  - 商业代理如 HiveMQ
- WebSockets
  - WebSockets 允许将 MQTT 数据直接传送到 Web 浏览器。
- 端口
  - MQTT 的标准端口号是 1883 。
- 模型
  - MQTT 基于发布/订阅模型，必须要有代理服务器，
  - 一个 MQTT 服务器可以同时处理成千上万个客户端，
  - MQTT 支持广播消息。

## MQTT 协议的关键特性

> [关于 MQTT 你需要了解这些 - MQTT 中文站](https://www.mqtt.cn/376.html)

1. 简单易实现
   - 协议头部仅占用 2 个字节，消息格式清晰简单。
2. 支持三种不同的服务质量等级 (QoS)
   - QoS 0 : 最多交付一次，消息可能丢失。
   - QoS 1 : 至少交付一次，消息可能重复到达。
   - QoS 2 : 只交付一次，消息保证到达，且不会重复。
3. 轻量级和节省带宽
   - MQTT 协议头非常紧凑，消息传输时开销极小。
4. 双向通信
   - MQTT 基于发布/订阅模式，支持双向通信，即设备既可以发布消息，也可以订阅消息。
5. 安全性
   - MQTT 支持 TLS/SSL 加密，保证数据传输的安全性。
   - 还可提供用户名和密码认证机制，确保只有授权的设备能够连接和通信。
6. 在线状态感知
   - MQTT 使用心跳保活机制，保持连接活跃。
   - 若客户端长时间不活动，服务器可以感知到并主动断开连接。
   - 遗愿 (Last Will) 消息机制允许客户端在意外下线时发布一条指定消息，通知其他设备。

## MQTT 基本架构和组件

> [MQTT 协议的架构是怎样的？ - MQTT 中文站](https://www.mqtt.cn/635.html)

- 服务器 Broker
  - MQTT Broker 是中心服务器，负责接收所有发布的消息并将这些消息转发给所有订阅了相应主题的客户端。
  - Broker 负责维护客户端的会话信息，包括哪些客户端订阅了哪些主题。
  - Broker 还负责处理 QoS 流程和持久化功能。
- 客户端 Client
  - 客户端可以是任何设备，只要它们运行了 MQTT 客户端软件。
  - 客户端可以发布消息到一个主题，也可以订阅一个或多个主题来接收相关的消息。
- 主题 Topics
  - 主题是一个字符串，允许消息按类别进行组织。
  - 客户端可以发布消息到一个主题，也可以订阅一个主题来接受发布到该主题的消息。
  - 主题的层次结构使用斜线 ( / ) 分隔。
- 消息 Messages
  - 客户端发布的数据。
  - 可以是任何格式信息，如文本、二级制数据或 JSON 数据。
- 连接和会话
  - 当客户端想跟 Broker 通信时，首先需要建立一个连接。
  - 在连接时，客户端可以设置“清除会话”标志，决定是否在断开连接后保留会话状态。
  - 客户端也可以设置遗嘱消息，在客户端异常断开时由 Broker 发送一个消息。
- 服务质量等级 QoS ( Quality of Service )
  - OoS 定义了三个消息传输质量级别。
- 保留消息 Retained Messages
  - 当消息发布到某个主题时，可以被设置为“保留消息”。
  - 这意味着这个消息会被 Broker 保存，当有新的客户端订阅这个主题时，它会立即收到该保留消息。
- 最后遗嘱 LWT ( Last Will and Testament )
  - 客户端在连接到 Broker 时可以设置一个遗嘱消息。
  - 如果 Broker 检测到客户端异常断开连接，它会发布这个遗嘱消息到指定的主题。

MQTT 的架构基于发布/订阅模型，允许客户端发布消息和订阅主题，而 Broker 则负责管理这些消息和主题，并确保消息正确地传输到相关的订阅者。
